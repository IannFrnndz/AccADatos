<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:replace="~{fragments/header :: header('Detalle del Paciente')}"></th:block>
</head>
<body>
<!-- Navbar -->
<th:block th:replace="~{fragments/navbar :: navbar}"></th:block>

<!-- Contenido Principal -->
<div class="main-content">
    <div class="container">
        <!-- Encabezado -->
        <div class="row mb-4">
            <div class="col-md-8">
                <h1 class="display-5">
                    <i class="bi bi-person-badge"></i> Detalle del Paciente
                </h1>
            </div>
            <div class="col-md-4 text-end">
                <!-- Botón volver -->
                <a th:href="@{${usuario.rol.name() == 'MEDICO' ? '/pacientes/mis-pacientes' : '/pacientes'}}"
                   class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Volver
                </a>

                <!-- Botón editar (ADMIN y MEDICO) -->
                <a sec:authorize="hasAnyRole('ADMIN', 'MEDICO')"
                   th:href="@{/pacientes/editar/{id}(id=${paciente.id})}"
                   class="btn btn-warning">
                    <i class="bi bi-pencil"></i> Editar
                </a>
            </div>
        </div>

        <!-- Mensajes -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill"></i> <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Información del Paciente -->
        <div class="row">
            <!-- Datos Personales -->
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <i class="bi bi-person-lines-fill"></i> Datos Personales
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <th width="40%"><i class="bi bi-hash"></i> ID:</th>
                                <td th:text="${paciente.id}">1</td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-person"></i> Nombre:</th>
                                <td><strong th:text="${paciente.nombre}">Nombre</strong></td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-people"></i> Apellidos:</th>
                                <td><strong th:text="${paciente.apellidos}">Apellidos</strong></td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-card-text"></i> DNI:</th>
                                <td th:text="${paciente.dni}">DNI</td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-telephone"></i> Teléfono:</th>
                                <td th:text="${paciente.telefono}">Teléfono</td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-calendar"></i> Fecha Nacimiento:</th>
                                <td th:text="${#temporals.format(paciente.fechaNacimiento, 'dd/MM/yyyy')}">
                                    Fecha
                                </td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-calendar-check"></i> Estado:</th>
                                <td>
                                        <span th:if="${paciente.activo}" class="badge bg-success">
                                            <i class="bi bi-check-circle"></i> Activo
                                        </span>
                                    <span th:unless="${paciente.activo}" class="badge bg-danger">
                                            <i class="bi bi-x-circle"></i> Inactivo
                                        </span>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Información Médica -->
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <i class="bi bi-hospital"></i> Información Médica
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <th width="40%"><i class="bi bi-person-badge"></i> Médico Asignado:</th>
                                <td>
                                        <span th:if="${paciente.medico != null}"
                                              class="badge bg-info"
                                              th:text="${paciente.medico.nombre}">
                                            Médico
                                        </span>
                                    <span th:if="${paciente.medico == null}"
                                          class="badge bg-secondary">
                                            Sin asignar
                                        </span>
                                </td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-envelope"></i> Email Médico:</th>
                                <td>
                                        <span th:if="${paciente.medico != null}"
                                              th:text="${paciente.medico.email}">
                                            Email
                                        </span>
                                    <span th:if="${paciente.medico == null}">-</span>
                                </td>
                            </tr>
                            <tr>
                                <th><i class="bi bi-calendar-plus"></i> Fecha Registro:</th>
                                <td th:text="${#temporals.format(paciente.fechaCreacion, 'dd/MM/yyyy HH:mm')}">
                                    Fecha
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historial Médico -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning">
                        <i class="bi bi-file-medical"></i> Historial Médico
                    </div>
                    <div class="card-body">
                        <div th:if="${paciente.historial != null and !paciente.historial.isEmpty()}"
                             class="alert alert-light"
                             style="white-space: pre-wrap;"
                             th:text="${paciente.historial}">
                            Historial
                        </div>
                        <div th:if="${paciente.historial == null or paciente.historial.isEmpty()}"
                             class="alert alert-secondary">
                            <i class="bi bi-info-circle"></i> No hay historial médico registrado
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Acciones adicionales -->
        <div class="row mt-3">
            <div class="col text-end">
                <!-- Eliminar (solo ADMIN) -->
                <form sec:authorize="hasRole('ADMIN')"
                      th:action="@{/pacientes/eliminar/{id}(id=${paciente.id})}"
                      method="post"
                      style="display: inline;"
                      onsubmit="return confirm('¿Está seguro de eliminar este paciente? Esta acción no se puede deshacer.');">
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Eliminar Paciente
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<th:block th:replace="~{fragments/footer :: footer}"></th:block>
</body>
</html>